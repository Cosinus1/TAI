# Generated by Django 5.2.8 on 2026-01-04 16:05

import django.contrib.gis.db.models.fields
import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("mobility", "0001_initial"),
    ]

    operations = [
        migrations.CreateModel(
            name="Dataset",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text="Unique dataset name", max_length=255, unique=True
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        blank=True, help_text="Dataset description and context"
                    ),
                ),
                (
                    "dataset_type",
                    models.CharField(
                        choices=[
                            ("gps_trace", "GPS Trace Data"),
                            ("od_matrix", "Origin-Destination Matrix"),
                            ("trajectory", "Aggregated Trajectories"),
                            ("stop_event", "Stop Events"),
                            ("custom", "Custom Dataset"),
                        ],
                        help_text="Type of mobility data",
                        max_length=50,
                    ),
                ),
                (
                    "data_format",
                    models.CharField(
                        choices=[
                            ("csv", "CSV File"),
                            ("txt", "Text File"),
                            ("json", "JSON File"),
                            ("geojson", "GeoJSON File"),
                            ("shapefile", "Shapefile"),
                            ("api", "API Endpoint"),
                        ],
                        help_text="Source data format",
                        max_length=50,
                    ),
                ),
                (
                    "field_mapping",
                    models.JSONField(
                        default=dict, help_text="Maps source fields to standard schema"
                    ),
                ),
                (
                    "source_url",
                    models.URLField(
                        blank=True, help_text="Original data source URL", null=True
                    ),
                ),
                (
                    "geographic_scope",
                    models.CharField(
                        blank=True,
                        help_text="Geographic coverage (e.g., 'Beijing, China')",
                        max_length=255,
                    ),
                ),
                (
                    "temporal_range_start",
                    models.DateTimeField(
                        blank=True, help_text="Start of temporal coverage", null=True
                    ),
                ),
                (
                    "temporal_range_end",
                    models.DateTimeField(
                        blank=True, help_text="End of temporal coverage", null=True
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="Dataset is available for queries"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Mobility Dataset",
                "verbose_name_plural": "Mobility Datasets",
                "db_table": "mobility_dataset",
                "ordering": ["-created_at"],
            },
        ),
        migrations.AlterModelOptions(
            name="tdriveimportlog",
            options={"managed": False},
        ),
        migrations.AlterModelOptions(
            name="tdriverawpoint",
            options={"managed": False},
        ),
        migrations.AlterModelOptions(
            name="tdrivetrajectory",
            options={"managed": False},
        ),
        migrations.AlterModelOptions(
            name="tdrivevalidationerror",
            options={"managed": False},
        ),
        migrations.CreateModel(
            name="ImportJob",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                (
                    "source_type",
                    models.CharField(
                        choices=[
                            ("file", "File Upload"),
                            ("directory", "Directory Scan"),
                            ("url", "URL Download"),
                            ("api", "API Import"),
                        ],
                        help_text="Import source type",
                        max_length=50,
                    ),
                ),
                (
                    "source_path",
                    models.TextField(help_text="Path, URL, or identifier of source"),
                ),
                (
                    "import_config",
                    models.JSONField(
                        default=dict, help_text="Import-specific settings"
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("processing", "Processing"),
                            ("completed", "Completed"),
                            ("failed", "Failed"),
                            ("cancelled", "Cancelled"),
                        ],
                        db_index=True,
                        default="pending",
                        max_length=50,
                    ),
                ),
                (
                    "total_records",
                    models.IntegerField(
                        blank=True, help_text="Total records to process", null=True
                    ),
                ),
                (
                    "processed_records",
                    models.IntegerField(
                        default=0, help_text="Records processed so far"
                    ),
                ),
                (
                    "successful_records",
                    models.IntegerField(default=0, help_text="Successfully imported"),
                ),
                (
                    "failed_records",
                    models.IntegerField(default=0, help_text="Failed imports"),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "started_at",
                    models.DateTimeField(
                        blank=True, help_text="Processing start time", null=True
                    ),
                ),
                (
                    "completed_at",
                    models.DateTimeField(
                        blank=True, help_text="Processing end time", null=True
                    ),
                ),
                (
                    "duration_seconds",
                    models.FloatField(
                        blank=True, help_text="Total processing time", null=True
                    ),
                ),
                (
                    "error_message",
                    models.TextField(blank=True, help_text="Error details if failed"),
                ),
                (
                    "dataset",
                    models.ForeignKey(
                        help_text="Target dataset",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="import_jobs",
                        to="mobility.dataset",
                    ),
                ),
            ],
            options={
                "verbose_name": "Import Job",
                "verbose_name_plural": "Import Jobs",
                "db_table": "mobility_importjob",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="GPSPoint",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "entity_id",
                    models.CharField(
                        db_index=True,
                        help_text="Entity identifier (vehicle, person, device)",
                        max_length=100,
                    ),
                ),
                (
                    "timestamp",
                    models.DateTimeField(
                        db_index=True, help_text="Recording timestamp"
                    ),
                ),
                (
                    "longitude",
                    models.FloatField(
                        help_text="Longitude (WGS84)",
                        validators=[
                            django.core.validators.MinValueValidator(-180),
                            django.core.validators.MaxValueValidator(180),
                        ],
                    ),
                ),
                (
                    "latitude",
                    models.FloatField(
                        help_text="Latitude (WGS84)",
                        validators=[
                            django.core.validators.MinValueValidator(-90),
                            django.core.validators.MaxValueValidator(90),
                        ],
                    ),
                ),
                (
                    "geom",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        help_text="PostGIS geometry (auto-generated)",
                        null=True,
                        srid=4326,
                    ),
                ),
                (
                    "altitude",
                    models.FloatField(
                        blank=True, help_text="Altitude in meters", null=True
                    ),
                ),
                (
                    "accuracy",
                    models.FloatField(
                        blank=True, help_text="GPS accuracy in meters", null=True
                    ),
                ),
                (
                    "speed",
                    models.FloatField(
                        blank=True, help_text="Instantaneous speed (km/h)", null=True
                    ),
                ),
                (
                    "heading",
                    models.FloatField(
                        blank=True,
                        help_text="Direction of travel (degrees)",
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(360),
                        ],
                    ),
                ),
                (
                    "extra_attributes",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Additional dataset-specific attributes",
                    ),
                ),
                (
                    "is_valid",
                    models.BooleanField(
                        db_index=True, default=True, help_text="Point passed validation"
                    ),
                ),
                (
                    "validation_flags",
                    models.JSONField(
                        blank=True, default=dict, help_text="Validation issues (if any)"
                    ),
                ),
                (
                    "imported_at",
                    models.DateTimeField(
                        default=django.utils.timezone.now, help_text="Import timestamp"
                    ),
                ),
                (
                    "dataset",
                    models.ForeignKey(
                        help_text="Parent dataset",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="gps_points",
                        to="mobility.dataset",
                    ),
                ),
            ],
            options={
                "verbose_name": "GPS Point",
                "verbose_name_plural": "GPS Points",
                "db_table": "mobility_gpspoint",
                "ordering": ["dataset", "entity_id", "timestamp"],
                "indexes": [
                    models.Index(
                        fields=["dataset", "entity_id", "timestamp"],
                        name="idx_gps_dataset_entity_time",
                    ),
                    models.Index(
                        fields=["dataset", "timestamp"], name="idx_gps_dataset_time"
                    ),
                    models.Index(
                        fields=["entity_id", "timestamp"], name="idx_gps_entity_time"
                    ),
                ],
                "unique_together": {("dataset", "entity_id", "timestamp")},
            },
        ),
        migrations.CreateModel(
            name="Trajectory",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "entity_id",
                    models.CharField(
                        db_index=True, help_text="Entity identifier", max_length=100
                    ),
                ),
                (
                    "trajectory_date",
                    models.DateField(db_index=True, help_text="Date of trajectory"),
                ),
                ("start_time", models.DateTimeField(help_text="Trajectory start")),
                ("end_time", models.DateTimeField(help_text="Trajectory end")),
                (
                    "duration_seconds",
                    models.IntegerField(
                        blank=True, help_text="Total duration", null=True
                    ),
                ),
                ("point_count", models.IntegerField(help_text="Number of GPS points")),
                (
                    "total_distance_meters",
                    models.FloatField(
                        blank=True, help_text="Total distance traveled", null=True
                    ),
                ),
                (
                    "avg_speed_kmh",
                    models.FloatField(blank=True, help_text="Average speed", null=True),
                ),
                (
                    "max_speed_kmh",
                    models.FloatField(blank=True, help_text="Maximum speed", null=True),
                ),
                (
                    "geom",
                    django.contrib.gis.db.models.fields.LineStringField(
                        blank=True,
                        help_text="Full trajectory line",
                        null=True,
                        srid=4326,
                    ),
                ),
                (
                    "bbox",
                    django.contrib.gis.db.models.fields.PolygonField(
                        blank=True, help_text="Bounding box", null=True, srid=4326
                    ),
                ),
                (
                    "metrics",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Additional computed metrics",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "dataset",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="trajectories",
                        to="mobility.dataset",
                    ),
                ),
            ],
            options={
                "verbose_name": "Trajectory",
                "verbose_name_plural": "Trajectories",
                "db_table": "mobility_trajectory",
                "ordering": ["dataset", "entity_id", "trajectory_date"],
                "indexes": [
                    models.Index(
                        fields=["dataset", "entity_id"], name="idx_traj_dataset_entity"
                    ),
                    models.Index(
                        fields=["dataset", "trajectory_date"],
                        name="idx_traj_dataset_date",
                    ),
                ],
                "unique_together": {("dataset", "entity_id", "trajectory_date")},
            },
        ),
        migrations.CreateModel(
            name="ValidationError",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "record_number",
                    models.IntegerField(
                        blank=True, help_text="Line/record number in source", null=True
                    ),
                ),
                (
                    "raw_data",
                    models.TextField(
                        blank=True, help_text="Raw data that failed validation"
                    ),
                ),
                (
                    "error_type",
                    models.CharField(
                        db_index=True, help_text="Error category", max_length=100
                    ),
                ),
                ("error_message", models.TextField(help_text="Detailed error message")),
                (
                    "field_name",
                    models.CharField(
                        blank=True, help_text="Field that caused error", max_length=100
                    ),
                ),
                (
                    "expected_value",
                    models.CharField(
                        blank=True, help_text="Expected value format", max_length=255
                    ),
                ),
                (
                    "actual_value",
                    models.CharField(
                        blank=True, help_text="Actual value received", max_length=255
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "import_job",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="validation_errors",
                        to="mobility.importjob",
                    ),
                ),
            ],
            options={
                "verbose_name": "Validation Error",
                "verbose_name_plural": "Validation Errors",
                "db_table": "mobility_validationerror",
                "ordering": ["-created_at"],
                "indexes": [
                    models.Index(
                        fields=["import_job", "error_type"], name="idx_val_job_type"
                    )
                ],
            },
        ),
    ]
